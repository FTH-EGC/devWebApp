@model ApplicacionWebp.Models.ViewModels.ListTablaViewModel
@{
    ViewBag.Title = "Index";
}

<script src="~/Scripts/jquery-3.4.1.min.js"></script>


<h1 class="text-center ">Usuarios</h1>

<div class="row">
    <div class="container">
        @Html.Partial("Tablas")

        <button class="btn btn-success" onclick="AgregarUsuario()" data-target="#modalCrearEditar" data-toggle="modal" id="agregar">Agregar</button>

        <div class="modal fade" id="modalCrearEditar" role="dialog" style="margin-top: 65px">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="text-center" id="titulo"></h2>
                    </div>
                    <div class="modal-body">

                        <form role="form" id="form">

                            <fieldset id="submitForm">
                                @Html.HiddenFor(m => m.Id, new { @id = "UsuId" })

                                <div class="form-group">
                                    @Html.TextBoxFor(m => m.Nombre, new { @id = "UsuNombre", @class = "form-control", @placeholder = "Nombre del Usuario" })
                                </div>
                                <div class="form-group">
                                    @Html.TextBoxFor(m => m.Apellido_Paterno, new { @id = "UsuApellidoP", @class = "form-control", @placeholder = "Apellido Paterno" })
                                </div>
                                <div class="form-group">
                                    @Html.TextBoxFor(m => m.Apellido_Materno, new { @id = "UsuApellidoM", @class = "form-control", @placeholder = "Apellido Materno" })
                                </div>
                                <div class="form-group">
                                    @Html.TextBoxFor(m => m.Edad, new { @id = "UsuEdad", @class = "form-control", @placeholder = "Edad" })
                                </div>
                                <div class="form-group">
                                    @Html.EditorFor(m => m.isactive, new { htmlAttributes = new { @class = "form-control" } })
                                </div>
                                <div class="form-group">
                                    <input type="submit" class="btn btn-success" onclick="guardarRegistro(event)" value="Guardar" id="guardarEditar" />
                                </div>
                            </fieldset>
                        </form>

                        <button class="btn btn-danger btn-lg btn-block" data-dismiss="modal" onclick="resetearForm()">Cerrar&times;</button>
                    </div>
                </div>
            </div>
        </div>



    </div>
</div>


<script>


    //Resetear formulario
    function resetearForm() {
        $("#form")[0].reset();
    }


    //Trae la informacion de la BD y la muestra en los inputs
    function EditarUsuario(UserId) {
        var url = "/Agregar/GetUsuarioById?UserId=" + UserId;

        const titulo = document.querySelector("#titulo");
        const btnEditar = document.querySelector("#guardarEditar");
        titulo.textContent = "Editar Usuario";
        btnEditar.classList.remove("btn-success");
        btnEditar.classList.add("btn-primary");
        btnEditar.value = "Editar";
        $.ajax({
            type: "GET",
            url: url,
            success: function (data) {
                const usId = document.querySelector("#UsuId");
                const nombre = document.querySelector("#UsuNombre");
                const apellidoP = document.querySelector("#UsuApellidoP");
                const apellidoM = document.querySelector("#UsuApellidoM");
                const edad = document.querySelector("#UsuEdad");
                const select = document.querySelector("#form select");
                var obj = JSON.parse(data);

                usId.value = obj.id;
                nombre.value = obj.nombre;
                apellidoP.value = obj.apellido_paterno;
                apellidoM.value = obj.apellido_materno;
                edad.value = obj.edad;
                select.value = obj.isactve;
                
            }
        })


    }

    //Boton de agregar
    function AgregarUsuario() {

        const titulo = document.querySelector("#titulo");
        const btnEditar = document.querySelector("#guardarEditar");
        titulo.textContent = "Crear Nuevo Usuario";
        btnEditar.classList.remove("btn-primary");
        btnEditar.classList.add("btn-success");
        btnEditar.value = "Crear Nuevo";
    } 


    function guardarRegistro(e) {
        e.preventDefault();
        const nombre = document.querySelector("#UsuNombre");
        const apellidoP = document.querySelector("#UsuApellidoP");
        const apellidoM = document.querySelector("#UsuApellidoM");
        const edad = document.querySelector("#UsuEdad");
        const select = document.querySelector("#form select");

        if (nombre.value === "" || apellidoP.value === "" || apellidoM.value === "" || edad.value === "" || select.value === "") {

            mostrarAlerta("Todos los campos son obligatorios", "error");
            return;

        }
        var data = $("#submitForm").serialize();

        $.ajax({
            type: "POST",
            url: "/Agregar/SaveDatainDB",
            data: data,
            success: function () {

            }
        })

    }



    function mostrarAlerta(mensaje, tipo) {
        const alerta = document.querySelector('.alerta');

        if (!alerta) {
            const div = document.createElement('div');
            const texto = document.createElement('p');
            const modalBody = document.querySelector('.modal-body');
            texto.textContent = mensaje;
            div.appendChild(texto);
            if (tipo === 'error') {
                div.classList.add('alert', 'text-center', 'alert-danger', 'alerta');
            } else {
                div.classList.add('alert', 'text-center', 'alert-success', 'alerta');

            }

            modalBody.insertBefore(div, modalBody.children[0]);

            setTimeout(() => {
                div.remove();
            }, 2000)
        }

    }



</script>
